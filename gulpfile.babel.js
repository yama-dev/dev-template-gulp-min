"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("gulp"),t=require("fs"),r=require("node-notifier"),s=require("gulp-sass"),i=require("node-sass"),n=require("gulp-postcss"),o=require("pixrem"),a=require("postcss-opacity"),c=require("autoprefixer"),u=require("cssnano"),l=require("css-declaration-sorter"),h=require("gulp-cached"),p=require("gulp-plumber"),f=require("path");require("colors");var d=require("@yama-dev/gulp-stream-util"),m=require("gulp-if"),g=require("gulp-rename"),y=require("gulp-javascript-obfuscator"),v=require("gulp-terser"),b=require("gulp-eslint"),_=require("gulp-babel"),w=require("webpack"),$=require("webpack-stream"),j=require("gulp-ejs");require("gulp-pug");var k=require("gulp-htmlmin"),E=require("@yama-dev/data-collector"),O=require("@yama-dev/data-template"),A=require("gulp-ignore"),D=require("gulp-htmlhint"),S=require("browser-sync"),x=require("util"),I=require("events"),B=require("assert"),q=require("del"),C=require("child_process"),R=require("gulp-prompt");function T(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var L=T(t),N=T(r),P=T(s),G=T(i),M=T(n),F=T(o),W=T(a),Q=T(c),U=T(u),H=T(l),z=T(h),K=T(p),Z=T(f),J=T(d),V=T(m),X=T(g),Y=T(y),ee=T(v),te=T(b),re=T(_),se=T(w),ie=T($),ne=T(j),oe=T(k),ae=T(E),ce=T(O),ue=T(A),le=T(D),he=T(S),pe=T(x),fe=T(I),de=T(B),me=T(q),ge=T(R),ye={name:"dev-template-gulp",version:"1.10.3",description:"Development environment for web site development",keywords:["web","gulp","template"],author:"yama-dev",license:"MIT",main:"index.js",scripts:{build:"rollup -c"},repository:{type:"git",url:"https://github.com/yama-dev/dev-template-gulp"},bugs:{url:"https://github.com/yama-dev/dev-template-gulp/issues",email:"tatsuya.yamamoto69@gmail.com"},devDependencies:{"@rollup/plugin-commonjs":"^16.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^10.0.0","rollup-plugin-terser":"^7.0.2"}};let ve={},be={};try{ve=L.default.readFileSync("./.config.json","utf8"),ve=JSON.parse(ve)}catch(e){console.log("[dev-template] not use .config.json")}be={source:"src/",sourceBuild:"",release:"release/"},ve.inputDirectory&&(be.source=ve.inputDirectory),ve.outputDirectory?be.sourceBuild=ve.outputDirectory:be.sourceBuild=be.source;let _e=ve,we=be,$e={htmllint:!0,jslint:!0};const je=process.argv.slice(2);je.map(((e,t)=>{if(/--/.test(e)){let r=e.replace("--","");je[t+1]?(/--/.test(je[t+1])?$e[r]=!0:$e[r]=je[t+1],$e[r]="false"!==$e[r]&&$e[r]):$e[r]=!0}}));let ke={path:we,user:_e,env:$e,outputDirectory:{dev:we.sourceBuild,release:we.release},watchDirectory:{html:`${we.sourceBuild}**/*.html`,ejs:`${we.source}**/*.ejs`,pug:`${we.source}**/*.pug`,slim:`${we.source}**/*.slim`,php:`${we.sourceBuild}**/*.php`,css:`${we.sourceBuild}**/*.css`,sass:`${we.source}**/*.scss`,jspre:`${we.source}**/*.js`,js:`${we.sourceBuild}**/*.js`,es:`${we.source}**/*.es*`},watchIgnoreDirectory:{html:[`!${we.source}**/wp/**/*.html`,`!${we.source}**/vender/**/*.html`,`!${we.source}**/vendor/**/*.html`,`!${we.source}**/inc/**/*.html`,`!${we.source}**/include/**/*.html`,`!${we.source}**/ssi/**/*.html`,`!${we.source}_*/**/*.html`,`!${we.source}__*/**/*.html`,`!${we.source}___*/**/*.html`,`!${we.sourceBuild}**/wp/**/*.html`,`!${we.sourceBuild}**/vender/**/*.html`,`!${we.sourceBuild}**/vendor/**/*.html`,`!${we.sourceBuild}**/inc/**/*.html`,`!${we.sourceBuild}**/include/**/*.html`,`!${we.sourceBuild}**/ssi/**/*.html`,`!${we.sourceBuild}_*/**/*.html`,`!${we.sourceBuild}__*/**/*.html`,`!${we.sourceBuild}___*/**/*.html`],ejs:[`!${we.source}**/_*.ejs`,`!${we.source}_*/**/*.ejs`,`!${we.source}__*/**/*.ejs`,`!${we.source}___*/**/*.ejs`],pug:[`!${we.source}**/_*.pug`,`!${we.source}_*/**/*.pug`,`!${we.source}__*/**/*.pug`,`!${we.source}___*/**/*.pug`],slim:[`!${we.source}**/_*.slim`,`!${we.source}_*/**/*.slim`,`!${we.source}__*/**/*.slim`,`!${we.source}___*/**/*.slim`],sass:[`!${we.source}**/wp/**/*.scss`,`!${we.source}**/vender/**/*.scss`,`!${we.source}**/vendor/**/*.scss`,`!${we.source}**/lib/**/*.scss`,`!${we.source}**/libs/**/*.scss`,`!${we.source}_*/**/*.scss`,`!${we.source}__*/**/*.scss`,`!${we.source}___*/**/*.scss`],css:[`!${we.source}**/_*.css`,`!${we.source}_*/**/*.css`,`!${we.source}__*/**/*.css`,`!${we.source}___*/**/*.css`,`!${we.sourceBuild}**/_*.css`,`!${we.sourceBuild}_*/**/*.css`,`!${we.sourceBuild}__*/**/*.css`,`!${we.sourceBuild}___*/**/*.css`],es:[`!${we.sourceBuild}**/wp/**/*.es*`,`!${we.sourceBuild}**/vender/**/*.es*`,`!${we.sourceBuild}**/vendor/**/*.es*`,`!${we.sourceBuild}**/lib/**/*.es*`,`!${we.sourceBuild}**/libs/**/*.es*`,`!${we.sourceBuild}**/*.min.es*`,`!${we.sourceBuild}_*/**/*.es*`,`!${we.sourceBuild}__*/**/*.es*`,`!${we.sourceBuild}___*/**/*.es*`],js:[`!${we.sourceBuild}**/wp/**/*.js`,`!${we.sourceBuild}**/vender/**/*.js`,`!${we.sourceBuild}**/vendor/**/*.js`,`!${we.sourceBuild}**/lib/**/*.js`,`!${we.sourceBuild}**/libs/**/*.js`,`!${we.sourceBuild}**/*.min.js`,`!${we.sourceBuild}_*/**/*.js`,`!${we.sourceBuild}__*/**/*.js`,`!${we.sourceBuild}___*/**/*.js`]},deployDirectory:[`${we.source}**/*`,`!${we.source}_*/**`,`!${we.source}__*/**`,`!${we.source}___*/**`,`!${we.source}vender/**`,`!${we.source}vendor/**`,`!${we.source}**/*.ejs`,`!${we.source}**/*.pug`,`!${we.source}**/*.slim`,`!${we.source}**/_*.css`,`!${we.source}**/*.scss`,`!${we.source}**/_*.js`,`!${we.source}**/*.es*`],cleanDirectory:[`${we.source}**/*.map`,`${we.sourceBuild}**/*.map`,`${we.source}**/*.sourcemap`,`${we.sourceBuild}**/*.sourcemap`]};
/*!
 * DEV TEMPLATE GULP
 * Repository https://github.com/yama-dev/dev-template-gulp
 * Copyright yama-dev
 * Licensed under the MIT license.
 */(ke.user.php||ke.env.php)&&(ke.user.proxy="127.0.0.1:3333",ke.env.htmllint=!1,ke.env.jslint=!1),(ke.user.twig||ke.env.twig)&&(ke.user.proxy="127.0.0.1:3333",ke.env.htmllint=!1,ke.env.jslint=!1,ke.deployDirectory.push(`${we.source}**/_twig/**`)),P.default.compiler=G.default;const Ee=(t=!1)=>{let r=ke.watchIgnoreDirectory.sass.slice();r.unshift(ke.watchDirectory.sass);let s=!1;!0===ke.user.sourcemaps||!0===ke.user.sourcemap?s=!0:!1!==ke.user.sourcemaps&&!1!==ke.user.sourcemap||(s=!1),!0===ke.env.sourcemaps||!0===ke.env.sourcemap?s=!0:!1!==ke.env.sourcemaps&&!1!==ke.env.sourcemap||(s=!1),1!=ke.env.production&&1!=ke.env.prod||(s=!1),!0===t&&(z.default.caches={});let i=[H.default({order:"concentric-css"}),Q.default({grid:!0}),F.default(),W.default()];return ke.env.cssmin&&i.push(U.default({autoprefixer:!1})),e.src(r,{sourcemaps:s}).pipe(z.default("sass")).pipe(K.default({errorHandler(e){N.default.notify({title:"Sass コンパイル エラー",message:e.message})}})).pipe(P.default({outputStyle:"expanded",indentType:"space",indentWidth:2,precision:3}).on("error",P.default.logError)).pipe(M.default(i)).pipe(e.dest(ke.outputDirectory.dev,{sourcemaps:"."}))};let Oe=()=>{let t=ke.watchIgnoreDirectory.js.slice();t.unshift(ke.watchDirectory.es);let r=!1;!0===ke.user.sourcemaps||!0===ke.user.sourcemap?r=!0:!1!==ke.user.sourcemaps&&!1!==ke.user.sourcemap||(r=!1),!0===ke.env.sourcemaps||!0===ke.env.sourcemap?r=!0:!1!==ke.env.sourcemaps&&!1!==ke.env.sourcemap||(r=!1),1!=ke.env.production&&1!=ke.env.prod||(r=!1);let s=!1;!0!==ke.user.jsmin&&!0!==ke.env.jsmin&&!0!==ke.user.hide&&!0!==ke.env.hide||(s=!0);let i=!1;!0!==ke.user.obfuscator&&!0!==ke.env.obfuscator&&!0!==ke.user.hide&&!0!==ke.env.hide||(s=!1,i=!0);let n={compact:!0,controlFlowFlattening:!1,deadCodeInjection:!1,debugProtection:!1,debugProtectionInterval:!1,disableConsoleOutput:!1,identifierNamesGenerator:"hexadecimal",log:!1,numbersToExpressions:!1,renameGlobals:!1,rotateStringArray:!0,selfDefending:!1,shuffleStringArray:!0,simplify:!0,splitStrings:!1,stringArray:!0,stringArrayEncoding:[],stringArrayWrappersCount:1,stringArrayWrappersChainedCalls:!0,stringArrayWrappersType:"variable",stringArrayThreshold:.75,unicodeEscapeSequence:!1},o={compact:!0,controlFlowFlattening:!0,controlFlowFlatteningThreshold:1,deadCodeInjection:!0,deadCodeInjectionThreshold:1,debugProtection:!0,debugProtectionInterval:!0,disableConsoleOutput:!0,identifierNamesGenerator:"hexadecimal",log:!1,numbersToExpressions:!0,renameGlobals:!1,rotateStringArray:!0,selfDefending:!0,shuffleStringArray:!0,simplify:!0,splitStrings:!0,splitStringsChunkLength:5,stringArray:!0,stringArrayEncoding:["rc4"],stringArrayWrappersCount:5,stringArrayWrappersChainedCalls:!0,stringArrayWrappersType:"function",stringArrayThreshold:1,transformObjectKeys:!0,unicodeEscapeSequence:!1};return!0!==ke.user.obfuscator_max&&!0!==ke.env.obfuscator_max||(o=n),e.src(t,{sourcemaps:r}).pipe(te.default()).pipe(te.default.format()).pipe(K.default({errorHandler(e){N.default.notify({title:"BABEL コンパイル エラー",message:e.message})}})).pipe(re.default()).on("error",(function(e){console.log("[dev-template] ERROR ",e),this.emit("end")})).pipe(V.default(s,ee.default())).pipe(V.default(i,Y.default(o))).pipe(e.dest(ke.outputDirectory.dev,{sourcemaps:r}))},Ae=()=>{let t=ke.watchIgnoreDirectory.js.slice();t.unshift(ke.watchDirectory.es);let r=ke.user.webpackConfig?`../../${ke.user.webpackConfig}`:"../../webpack.config.js";return L.default.existsSync(Z.default.join(__dirname,r))||(console.log(`[dev-template] NOT FOUND ${Z.default.join(__dirname,r)}`.white.bgRed),process.exit(0)),e.src(t).pipe(K.default({errorHandler(e){N.default.notify({title:"WEBPACK コンパイル エラー",message:e.message})}})).pipe(ie.default({config:require(r)},se.default)).on("error",(function(e){console.log("[dev-template] ERROR ",e),this.emit("end")})).pipe(e.dest(ke.outputDirectory.dev))},De=()=>ke.user.webpack||ke.env.webpack?Ae():Oe(),Se=()=>{let t=ke.watchIgnoreDirectory.ejs.slice();t.unshift(ke.watchDirectory.ejs);let r=!1;!0!==ke.user.htmlmin&&!0!==ke.env.htmlmin||(r=!0);let s={};if(ke.user.ejs&&(s={ejs:ke.user.ejs,env:ke.env,data:null}),ke.user.data){console.log("[dev-template] use data.");let e={data:ke.user.data.directory?ke.user.data.directory:"data",order:ke.user.data.order?ke.user.data.order:"DESC",orderby:ke.user.data.orderby?ke.user.data.orderby:"date"};s.data=ae.default(e),ke.user.data.template&&(console.log("[dev-template] use data-template."),ce.default({dataall:s,data:s.data,template:ke.user.data.template}))}return e.src(t,{since:e.lastRun(Se)}).pipe(K.default()).pipe(J.default((function(){if(ke.user.ejs){let e=s.ejs.pages.find((e=>e.slug==this.dir));s.ejs.current=null,e&&(s.ejs.current=e)}}))).pipe(ne.default(s,{},{ext:""})).pipe(X.default({extname:""})).pipe(V.default(r,oe.default())).pipe(e.dest(ke.outputDirectory.dev))},xe=()=>{let t=ke.deployDirectory.slice();if(ke.user.webpack){let e=ke.user.webpackConfig?`../../${ke.user.webpackConfig}`:"../../webpack.config.js",r=require(e);Object.keys(r.entry).forEach((function(e){t.push(`!${ke.path.source}**/*${Z.default.basename(r.entry[e])}`)}))}return e.src(t,{since:e.lastRun(xe)}).pipe(ue.default.include({isFile:!0})).pipe(e.dest(ke.outputDirectory.dev))},Ie=()=>{let t=ke.watchIgnoreDirectory.html.slice();return t.unshift(ke.watchDirectory.html),e.src(t).pipe(K.default({errorHandler(e){N.default.notify({title:"HTML LINT エラー",message:e.message}),this.emit("end")}})).pipe(le.default({"tagname-lowercase":!0,"attr-lowercase":["viewBox"],"attr-value-double-quotes":!0,"attr-value-not-empty":!1,"attr-no-duplication":!0,"doctype-first":!1,"tag-pair":!0,"tag-self-close":!1,"spec-char-escape":!0,"id-unique":!0,"src-not-empty":!0,"alt-require":!0,"head-script-disabled":!1,"img-alt-require":!0,"doctype-html5":!0,"id-class-value":!1,"style-disabled":!1,"space-tab-mixed-disabled":!0,"id-class-ad-disabled":!0,"href-abs-or-rel":!1,"attr-unsafe-chars":!0})).pipe(le.default.reporter())},Be=()=>{let t=ke.watchIgnoreDirectory.html.slice();return t.unshift(ke.watchDirectory.html),e.src(t,{since:e.lastRun(Be)}).pipe(oe.default({collapseWhitespace:!0})).pipe(e.dest(ke.outputDirectory.dev))};he.default.create();let qe=()=>{let t={reloadDelay:100,reloadDebounce:100,logLevel:"info",logPrefix:"dev-template"};if(ke.user.proxy?t.proxy=ke.user.proxy:ke.env.proxy?t.proxy=ke.env.proxy:t.server={baseDir:ke.outputDirectory.dev},ke.user.host&&(t.host=ke.user.host),ke.env.host&&(t.host=ke.env.host),he.default.init(t),ke.user.outputDirectory){let t=ke.deployDirectory.slice();if(ke.user.webpack){let e=ke.user.webpackConfig?`../${ke.user.webpackConfig}`:"../webpack.config.js",r=require(e);Object.keys(r.entry).forEach((function(e){t.push(`!${ke.path.source}**/*${Z.default.basename(r.entry[e])}`)}))}e.watch(t).on("change",xe),xe()}let r=ke.watchIgnoreDirectory.html.slice();r.unshift(ke.watchDirectory.html),ke.env.htmlmin?e.watch(r,Be):(ke.env.htmllint&&e.watch(r).on("change",(function(e,t){Ie()})),e.watch(r).on("change",he.default.reload));const s=ke.watchIgnoreDirectory.js.slice();s.unshift(ke.watchDirectory.js),e.watch(s).on("change",he.default.reload);const i=ke.watchIgnoreDirectory.css.slice();i.unshift(ke.watchDirectory.css);e.watch(i).on("change",(function(t,r){e.src(t).pipe(he.default.stream())})),e.watch(ke.watchDirectory.php).on("change",he.default.reload),ke.user.outputDirectory&&he.default.reload()};var Ce="win32"===process.platform,Re=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function Te(e){return"function"==typeof e?e:function(){var e;if(Re){var t=new Error;e=function(e){e&&(t.message=e.message,r(e=t))}}else e=r;return e;function r(e){if(e){if(process.throwDeprecation)throw e;if(!process.noDeprecation){var t="fs: missing callback "+(e.stack||e.message);process.traceDeprecation?console.trace(t):console.error(t)}}}}()}if(Z.default.normalize,Ce)var Le=/(.*?)(?:[\/\\]+|$)/g;else Le=/(.*?)(?:[\/]+|$)/g;if(Ce)var Ne=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/;else Ne=/^[\/]*/;var Pe=function(e,t){if(e=Z.default.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var r,s,i,n,o=e,a={},c={};function u(){var t=Ne.exec(e);r=t[0].length,s=t[0],i=t[0],n="",Ce&&!c[i]&&(L.default.lstatSync(i),c[i]=!0)}for(u();r<e.length;){Le.lastIndex=r;var l=Le.exec(e);if(n=s,s+=l[0],i=n+l[1],r=Le.lastIndex,!(c[i]||t&&t[i]===i)){var h;if(t&&Object.prototype.hasOwnProperty.call(t,i))h=t[i];else{var p=L.default.lstatSync(i);if(!p.isSymbolicLink()){c[i]=!0,t&&(t[i]=i);continue}var f=null;if(!Ce){var d=p.dev.toString(32)+":"+p.ino.toString(32);a.hasOwnProperty(d)&&(f=a[d])}null===f&&(L.default.statSync(i),f=L.default.readlinkSync(i)),h=Z.default.resolve(n,f),t&&(t[i]=h),Ce||(a[d]=f)}e=Z.default.resolve(h,e.slice(r)),u()}}return t&&(t[o]=e),e},Ge=function(e,t,r){if("function"!=typeof r&&(r=Te(t),t=null),e=Z.default.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(r.bind(null,null,t[e]));var s,i,n,o,a=e,c={},u={};function l(){var t=Ne.exec(e);s=t[0].length,i=t[0],n=t[0],o="",Ce&&!u[n]?L.default.lstat(n,(function(e){if(e)return r(e);u[n]=!0,h()})):process.nextTick(h)}function h(){if(s>=e.length)return t&&(t[a]=e),r(null,e);Le.lastIndex=s;var c=Le.exec(e);return o=i,i+=c[0],n=o+c[1],s=Le.lastIndex,u[n]||t&&t[n]===n?process.nextTick(h):t&&Object.prototype.hasOwnProperty.call(t,n)?d(t[n]):L.default.lstat(n,p)}function p(e,s){if(e)return r(e);if(!s.isSymbolicLink())return u[n]=!0,t&&(t[n]=n),process.nextTick(h);if(!Ce){var i=s.dev.toString(32)+":"+s.ino.toString(32);if(c.hasOwnProperty(i))return f(null,c[i],n)}L.default.stat(n,(function(e){if(e)return r(e);L.default.readlink(n,(function(e,t){Ce||(c[i]=t),f(e,t)}))}))}function f(e,s,i){if(e)return r(e);var n=Z.default.resolve(o,s);t&&(t[i]=n),d(n)}function d(t){e=Z.default.resolve(t,e.slice(s)),l()}l()},Me=ze;ze.realpath=ze,ze.sync=Ke,ze.realpathSync=Ke,ze.monkeypatch=function(){L.default.realpath=ze,L.default.realpathSync=Ke},ze.unmonkeypatch=function(){L.default.realpath=Fe,L.default.realpathSync=We};var Fe=L.default.realpath,We=L.default.realpathSync,Qe=process.version,Ue=/^v[0-5]\./.test(Qe);function He(e){return e&&"realpath"===e.syscall&&("ELOOP"===e.code||"ENOMEM"===e.code||"ENAMETOOLONG"===e.code)}function ze(e,t,r){if(Ue)return Fe(e,t,r);"function"==typeof t&&(r=t,t=null),Fe(e,t,(function(s,i){He(s)?Ge(e,t,r):r(s,i)}))}function Ke(e,t){if(Ue)return We(e,t);try{return We(e,t)}catch(r){if(He(r))return Pe(e,t);throw r}}var Ze=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Je=Ve;function Ve(e,t,r){e instanceof RegExp&&(e=Xe(e,r)),t instanceof RegExp&&(t=Xe(t,r));var s=Ye(e,t,r);return s&&{start:s[0],end:s[1],pre:r.slice(0,s[0]),body:r.slice(s[0]+e.length,s[1]),post:r.slice(s[1]+t.length)}}function Xe(e,t){var r=t.match(e);return r?r[0]:null}function Ye(e,t,r){var s,i,n,o,a,c=r.indexOf(e),u=r.indexOf(t,c+1),l=c;if(c>=0&&u>0){for(s=[],n=r.length;l>=0&&!a;)l==c?(s.push(l),c=r.indexOf(e,l+1)):1==s.length?a=[s.pop(),u]:((i=s.pop())<n&&(n=i,o=u),u=r.indexOf(t,l+1)),l=c<u&&c>=0?c:u;s.length&&(a=[n,o])}return a}Ve.range=Ye;var et=function(e){if(!e)return[];"{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2));return ft(function(e){return e.split("\\\\").join(tt).split("\\{").join(rt).split("\\}").join(st).split("\\,").join(it).split("\\.").join(nt)}(e),!0).map(at)},tt="\0SLASH"+Math.random()+"\0",rt="\0OPEN"+Math.random()+"\0",st="\0CLOSE"+Math.random()+"\0",it="\0COMMA"+Math.random()+"\0",nt="\0PERIOD"+Math.random()+"\0";function ot(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function at(e){return e.split(tt).join("\\").split(rt).join("{").split(st).join("}").split(it).join(",").split(nt).join(".")}function ct(e){if(!e)return[""];var t=[],r=Je("{","}",e);if(!r)return e.split(",");var s=r.pre,i=r.body,n=r.post,o=s.split(",");o[o.length-1]+="{"+i+"}";var a=ct(n);return n.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function ut(e){return"{"+e+"}"}function lt(e){return/^-?0\d/.test(e)}function ht(e,t){return e<=t}function pt(e,t){return e>=t}function ft(e,t){var r=[],s=Je("{","}",e);if(!s||/\$$/.test(s.pre))return[e];var i,n=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),a=n||o,c=s.body.indexOf(",")>=0;if(!a&&!c)return s.post.match(/,.*\}/)?ft(e=s.pre+"{"+s.body+st+s.post):[e];if(a)i=s.body.split(/\.\./);else if(1===(i=ct(s.body)).length&&1===(i=ft(i[0],!1).map(ut)).length)return(h=s.post.length?ft(s.post,!1):[""]).map((function(e){return s.pre+i[0]+e}));var u,l=s.pre,h=s.post.length?ft(s.post,!1):[""];if(a){var p=ot(i[0]),f=ot(i[1]),d=Math.max(i[0].length,i[1].length),m=3==i.length?Math.abs(ot(i[2])):1,g=ht;f<p&&(m*=-1,g=pt);var y=i.some(lt);u=[];for(var v=p;g(v,f);v+=m){var b;if(o)"\\"===(b=String.fromCharCode(v))&&(b="");else if(b=String(v),y){var _=d-b.length;if(_>0){var w=new Array(_+1).join("0");b=v<0?"-"+w+b.slice(1):w+b}}u.push(b)}}else u=function(e,t){for(var r=[],s=0;s<e.length;s++){var i=t(e[s],s);Ze(i)?r.push.apply(r,i):r.push(i)}return r}(i,(function(e){return ft(e,!1)}));for(var $=0;$<u.length;$++)for(var j=0;j<h.length;j++){var k=l+u[$]+h[j];(!t||a||k)&&r.push(k)}return r}var dt=wt;wt.Minimatch=$t;var mt={sep:"/"};try{mt=Z.default}catch(e){}var gt=wt.GLOBSTAR=$t.GLOBSTAR={},yt={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},vt="().*{}+?[]^$\\!".split("").reduce((function(e,t){return e[t]=!0,e}),{});var bt=/\/+/;function _t(e,t){e=e||{},t=t||{};var r={};return Object.keys(t).forEach((function(e){r[e]=t[e]})),Object.keys(e).forEach((function(t){r[t]=e[t]})),r}function wt(e,t,r){if("string"!=typeof t)throw new TypeError("glob pattern string required");return r||(r={}),!(!r.nocomment&&"#"===t.charAt(0))&&(""===t.trim()?""===e:new $t(t,r).match(e))}function $t(e,t){if(!(this instanceof $t))return new $t(e,t);if("string"!=typeof e)throw new TypeError("glob pattern string required");t||(t={}),e=e.trim(),"/"!==mt.sep&&(e=e.split(mt.sep).join("/")),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}function jt(e,t){if(t||(t=this instanceof $t?this.options:{}),void 0===(e=void 0===e?this.pattern:e))throw new TypeError("undefined pattern");return t.nobrace||!e.match(/\{.*\}/)?[e]:et(e)}wt.filter=function(e,t){return t=t||{},function(r,s,i){return wt(r,e,t)}},wt.defaults=function(e){if(!e||!Object.keys(e).length)return wt;var t=wt,r=function(r,s,i){return t.minimatch(r,s,_t(e,i))};return r.Minimatch=function(r,s){return new t.Minimatch(r,_t(e,s))},r},$t.defaults=function(e){return e&&Object.keys(e).length?wt.defaults(e).Minimatch:$t},$t.prototype.debug=function(){},$t.prototype.make=function(){if(this._made)return;var e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate();var r=this.globSet=this.braceExpand();t.debug&&(this.debug=console.error);this.debug(this.pattern,r),r=this.globParts=r.map((function(e){return e.split(bt)})),this.debug(this.pattern,r),r=r.map((function(e,t,r){return e.map(this.parse,this)}),this),this.debug(this.pattern,r),r=r.filter((function(e){return-1===e.indexOf(!1)})),this.debug(this.pattern,r),this.set=r},$t.prototype.parseNegate=function(){var e=this.pattern,t=!1,r=this.options,s=0;if(r.nonegate)return;for(var i=0,n=e.length;i<n&&"!"===e.charAt(i);i++)t=!t,s++;s&&(this.pattern=e.substr(s));this.negate=t},wt.braceExpand=function(e,t){return jt(e,t)},$t.prototype.braceExpand=jt,$t.prototype.parse=function(e,t){if(e.length>65536)throw new TypeError("pattern is too long");var r=this.options;if(!r.noglobstar&&"**"===e)return gt;if(""===e)return"";var s,i="",n=!!r.nocase,o=!1,a=[],c=[],u=!1,l=-1,h=-1,p="."===e.charAt(0)?"":r.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",f=this;function d(){if(s){switch(s){case"*":i+="[^/]*?",n=!0;break;case"?":i+="[^/]",n=!0;break;default:i+="\\"+s}f.debug("clearStateChar %j %j",s,i),s=!1}}for(var m,g=0,y=e.length;g<y&&(m=e.charAt(g));g++)if(this.debug("%s\t%s %s %j",e,g,i,m),o&&vt[m])i+="\\"+m,o=!1;else switch(m){case"/":return!1;case"\\":d(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",e,g,i,m),u){this.debug("  in class"),"!"===m&&g===h+1&&(m="^"),i+=m;continue}f.debug("call clearStateChar %j",s),d(),s=m,r.noext&&d();continue;case"(":if(u){i+="(";continue}if(!s){i+="\\(";continue}a.push({type:s,start:g-1,reStart:i.length,open:yt[s].open,close:yt[s].close}),i+="!"===s?"(?:(?!(?:":"(?:",this.debug("plType %j %j",s,i),s=!1;continue;case")":if(u||!a.length){i+="\\)";continue}d(),n=!0;var v=a.pop();i+=v.close,"!"===v.type&&c.push(v),v.reEnd=i.length;continue;case"|":if(u||!a.length||o){i+="\\|",o=!1;continue}d(),i+="|";continue;case"[":if(d(),u){i+="\\"+m;continue}u=!0,h=g,l=i.length,i+=m;continue;case"]":if(g===h+1||!u){i+="\\"+m,o=!1;continue}if(u){var b=e.substring(h+1,g);try{RegExp("["+b+"]")}catch(e){var _=this.parse(b,kt);i=i.substr(0,l)+"\\["+_[0]+"\\]",n=n||_[1],u=!1;continue}}n=!0,u=!1,i+=m;continue;default:d(),o?o=!1:!vt[m]||"^"===m&&u||(i+="\\"),i+=m}u&&(b=e.substr(h+1),_=this.parse(b,kt),i=i.substr(0,l)+"\\["+_[0],n=n||_[1]);for(v=a.pop();v;v=a.pop()){var w=i.slice(v.reStart+v.open.length);this.debug("setting tail",i,v),w=w.replace(/((?:\\{2}){0,64})(\\?)\|/g,(function(e,t,r){return r||(r="\\"),t+t+r+"|"})),this.debug("tail=%j\n   %s",w,w,v,i);var $="*"===v.type?"[^/]*?":"?"===v.type?"[^/]":"\\"+v.type;n=!0,i=i.slice(0,v.reStart)+$+"\\("+w}d(),o&&(i+="\\\\");var j=!1;switch(i.charAt(0)){case".":case"[":case"(":j=!0}for(var k=c.length-1;k>-1;k--){var E=c[k],O=i.slice(0,E.reStart),A=i.slice(E.reStart,E.reEnd-8),D=i.slice(E.reEnd-8,E.reEnd),S=i.slice(E.reEnd);D+=S;var x=O.split("(").length-1,I=S;for(g=0;g<x;g++)I=I.replace(/\)[+*?]?/,"");var B="";""===(S=I)&&t!==kt&&(B="$"),i=O+A+S+B+D}""!==i&&n&&(i="(?=.)"+i);j&&(i=p+i);if(t===kt)return[i,n];if(!n)return function(e){return e.replace(/\\(.)/g,"$1")}(e);var q=r.nocase?"i":"";try{var C=new RegExp("^"+i+"$",q)}catch(e){return new RegExp("$.")}return C._glob=e,C._src=i,C};var kt={};function Et(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}wt.makeRe=function(e,t){return new $t(e,t||{}).makeRe()},$t.prototype.makeRe=function(){if(this.regexp||!1===this.regexp)return this.regexp;var e=this.set;if(!e.length)return this.regexp=!1,this.regexp;var t=this.options,r=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",s=t.nocase?"i":"",i=e.map((function(e){return e.map((function(e){return e===gt?r:"string"==typeof e?function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}(e):e._src})).join("\\/")})).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,s)}catch(e){this.regexp=!1}return this.regexp},wt.match=function(e,t,r){var s=new $t(t,r=r||{});return e=e.filter((function(e){return s.match(e)})),s.options.nonull&&!e.length&&e.push(t),e},$t.prototype.match=function(e,t){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;var r=this.options;"/"!==mt.sep&&(e=e.split(mt.sep).join("/"));e=e.split(bt),this.debug(this.pattern,"split",e);var s,i,n=this.set;for(this.debug(this.pattern,"set",n),i=e.length-1;i>=0&&!(s=e[i]);i--);for(i=0;i<n.length;i++){var o=n[i],a=e;if(r.matchBase&&1===o.length&&(a=[s]),this.matchOne(a,o,t))return!!r.flipNegate||!this.negate}return!r.flipNegate&&this.negate},$t.prototype.matchOne=function(e,t,r){var s=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,n=0,o=e.length,a=t.length;i<o&&n<a;i++,n++){this.debug("matchOne loop");var c,u=t[n],l=e[i];if(this.debug(t,u,l),!1===u)return!1;if(u===gt){this.debug("GLOBSTAR",[t,u,l]);var h=i,p=n+1;if(p===a){for(this.debug("** at the end");i<o;i++)if("."===e[i]||".."===e[i]||!s.dot&&"."===e[i].charAt(0))return!1;return!0}for(;h<o;){var f=e[h];if(this.debug("\nglobstar while",e,h,t,p,f),this.matchOne(e.slice(h),t.slice(p),r))return this.debug("globstar found match!",h,o,f),!0;if("."===f||".."===f||!s.dot&&"."===f.charAt(0)){this.debug("dot detected!",e,h,t,p);break}this.debug("globstar swallow a segment, and continue"),h++}return!(!r||(this.debug("\n>>> no match, partial?",e,h,t,p),h!==o))}if("string"==typeof u?(c=s.nocase?l.toLowerCase()===u.toLowerCase():l===u,this.debug("string match",u,l,c)):(c=l.match(u),this.debug("pattern match",u,l,c)),!c)return!1}if(i===o&&n===a)return!0;if(i===o)return r;if(n===a)return i===o-1&&""===e[i];throw new Error("wtf?")};var Ot=Et((function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}})),At=Et((function(e){try{var t=pe.default;if("function"!=typeof t.inherits)throw"";e.exports=t.inherits}catch(t){e.exports=Ot}}));function Dt(e){return"/"===e.charAt(0)}function St(e){var t=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(e),r=t[1]||"",s=Boolean(r&&":"!==r.charAt(1));return Boolean(t[2]||s)}var xt="win32"===process.platform?St:Dt,It=Dt,Bt=St;xt.posix=It,xt.win32=Bt;var qt=Ut,Ct=Qt,Rt=function(e,t,r){r||(r={});if(r.matchBase&&-1===t.indexOf("/")){if(r.noglobstar)throw new Error("base matching requires globstar");t="**/"+t}e.silent=!!r.silent,e.pattern=t,e.strict=!1!==r.strict,e.realpath=!!r.realpath,e.realpathCache=r.realpathCache||Object.create(null),e.follow=!!r.follow,e.dot=!!r.dot,e.mark=!!r.mark,e.nodir=!!r.nodir,e.nodir&&(e.mark=!0);e.sync=!!r.sync,e.nounique=!!r.nounique,e.nonull=!!r.nonull,e.nosort=!!r.nosort,e.nocase=!!r.nocase,e.stat=!!r.stat,e.noprocess=!!r.noprocess,e.absolute=!!r.absolute,e.maxLength=r.maxLength||1/0,e.cache=r.cache||Object.create(null),e.statCache=r.statCache||Object.create(null),e.symlinks=r.symlinks||Object.create(null),function(e,t){e.ignore=t.ignore||[],Array.isArray(e.ignore)||(e.ignore=[e.ignore]);e.ignore.length&&(e.ignore=e.ignore.map(Ht))}(e,r),e.changedCwd=!1;var s=process.cwd();Ft(r,"cwd")?(e.cwd=Z.default.resolve(r.cwd),e.changedCwd=e.cwd!==s):e.cwd=s;e.root=r.root||Z.default.resolve(e.cwd,"/"),e.root=Z.default.resolve(e.root),"win32"===process.platform&&(e.root=e.root.replace(/\\/g,"/"));e.cwdAbs=xt(e.cwd)?e.cwd:zt(e,e.cwd),"win32"===process.platform&&(e.cwdAbs=e.cwdAbs.replace(/\\/g,"/"));e.nomount=!!r.nomount,r.nonegate=!0,r.nocomment=!0,e.minimatch=new Wt(t,r),e.options=e.minimatch.options},Tt=Ft,Lt=zt,Nt=function(e){for(var t=e.nounique,r=t?[]:Object.create(null),s=0,i=e.matches.length;s<i;s++){var n=e.matches[s];if(n&&0!==Object.keys(n).length){var o=Object.keys(n);t?r.push.apply(r,o):o.forEach((function(e){r[e]=!0}))}else if(e.nonull){var a=e.minimatch.globSet[s];t?r.push(a):r[a]=!0}}t||(r=Object.keys(r));e.nosort||(r=r.sort(e.nocase?Qt:Ut));if(e.mark){for(s=0;s<r.length;s++)r[s]=e._mark(r[s]);e.nodir&&(r=r.filter((function(t){var r=!/\/$/.test(t),s=e.cache[t]||e.cache[zt(e,t)];return r&&s&&(r="DIR"!==s&&!Array.isArray(s)),r})))}e.ignore.length&&(r=r.filter((function(t){return!Kt(e,t)})));e.found=r},Pt=function(e,t){var r=zt(e,t),s=e.cache[r],i=t;if(s){var n="DIR"===s||Array.isArray(s),o="/"===t.slice(-1);if(n&&!o?i+="/":!n&&o&&(i=i.slice(0,-1)),i!==t){var a=zt(e,i);e.statCache[a]=e.statCache[r],e.cache[a]=e.cache[r]}}return i},Gt=Kt,Mt=function(e,t){return!!e.ignore.length&&e.ignore.some((function(e){return!(!e.gmatcher||!e.gmatcher.match(t))}))};function Ft(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Wt=dt.Minimatch;function Qt(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}function Ut(e,t){return e.localeCompare(t)}function Ht(e){var t=null;if("/**"===e.slice(-3)){var r=e.replace(/(\/\*\*)+$/,"");t=new Wt(r,{dot:!0})}return{matcher:new Wt(e,{dot:!0}),gmatcher:t}}function zt(e,t){var r=t;return r="/"===t.charAt(0)?Z.default.join(e.root,t):xt(t)||""===t?t:e.changedCwd?Z.default.resolve(e.cwd,t):Z.default.resolve(t),"win32"===process.platform&&(r=r.replace(/\\/g,"/")),r}function Kt(e,t){return!!e.ignore.length&&e.ignore.some((function(e){return e.matcher.match(t)||!(!e.gmatcher||!e.gmatcher.match(t))}))}var Zt={alphasort:qt,alphasorti:Ct,setopts:Rt,ownProp:Tt,makeAbs:Lt,finish:Nt,mark:Pt,isIgnored:Gt,childrenIgnored:Mt},Jt=tr;tr.GlobSync=rr;var Vt=Zt.setopts,Xt=Zt.ownProp,Yt=Zt.childrenIgnored,er=Zt.isIgnored;function tr(e,t){if("function"==typeof t||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");return new rr(e,t).found}function rr(e,t){if(!e)throw new Error("must provide pattern");if("function"==typeof t||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof rr))return new rr(e,t);if(Vt(this,e,t),this.noprocess)return this;var r=this.minimatch.set.length;this.matches=new Array(r);for(var s=0;s<r;s++)this._process(this.minimatch.set[s],s,!1);this._finish()}rr.prototype._finish=function(){if(de.default(this instanceof rr),this.realpath){var e=this;this.matches.forEach((function(t,r){var s=e.matches[r]=Object.create(null);for(var i in t)try{i=e._makeAbs(i),s[Me.realpathSync(i,e.realpathCache)]=!0}catch(t){if("stat"!==t.syscall)throw t;s[e._makeAbs(i)]=!0}}))}Zt.finish(this)},rr.prototype._process=function(e,t,r){de.default(this instanceof rr);for(var s,i=0;"string"==typeof e[i];)i++;switch(i){case e.length:return void this._processSimple(e.join("/"),t);case 0:s=null;break;default:s=e.slice(0,i).join("/")}var n,o=e.slice(i);null===s?n=".":xt(s)||xt(e.join("/"))?(s&&xt(s)||(s="/"+s),n=s):n=s;var a=this._makeAbs(n);Yt(this,n)||(o[0]===dt.GLOBSTAR?this._processGlobStar(s,n,a,o,t,r):this._processReaddir(s,n,a,o,t,r))},rr.prototype._processReaddir=function(e,t,r,s,i,n){var o=this._readdir(r,n);if(o){for(var a=s[0],c=!!this.minimatch.negate,u=a._glob,l=this.dot||"."===u.charAt(0),h=[],p=0;p<o.length;p++){if("."!==(m=o[p]).charAt(0)||l)(c&&!e?!m.match(a):m.match(a))&&h.push(m)}var f=h.length;if(0!==f)if(1!==s.length||this.mark||this.stat){s.shift();for(p=0;p<f;p++){var d;m=h[p];d=e?[e,m]:[m],this._process(d.concat(s),i,n)}}else{this.matches[i]||(this.matches[i]=Object.create(null));for(var p=0;p<f;p++){var m=h[p];e&&(m="/"!==e.slice(-1)?e+"/"+m:e+m),"/"!==m.charAt(0)||this.nomount||(m=Z.default.join(this.root,m)),this._emitMatch(i,m)}}}},rr.prototype._emitMatch=function(e,t){if(!er(this,t)){var r=this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var s=this.cache[r];if("DIR"===s||Array.isArray(s))return}this.matches[e][t]=!0,this.stat&&this._stat(t)}}},rr.prototype._readdirInGlobStar=function(e){if(this.follow)return this._readdir(e,!1);var t,r;try{r=L.default.lstatSync(e)}catch(e){if("ENOENT"===e.code)return null}var s=r&&r.isSymbolicLink();return this.symlinks[e]=s,s||!r||r.isDirectory()?t=this._readdir(e,!1):this.cache[e]="FILE",t},rr.prototype._readdir=function(e,t){if(t&&!Xt(this.symlinks,e))return this._readdirInGlobStar(e);if(Xt(this.cache,e)){var r=this.cache[e];if(!r||"FILE"===r)return null;if(Array.isArray(r))return r}try{return this._readdirEntries(e,L.default.readdirSync(e))}catch(t){return this._readdirError(e,t),null}},rr.prototype._readdirEntries=function(e,t){if(!this.mark&&!this.stat)for(var r=0;r<t.length;r++){var s=t[r];s="/"===e?e+s:e+"/"+s,this.cache[s]=!0}return this.cache[e]=t,t},rr.prototype._readdirError=function(e,t){switch(t.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(e);if(this.cache[r]="FILE",r===this.cwdAbs){var s=new Error(t.code+" invalid cwd "+this.cwd);throw s.path=this.cwd,s.code=t.code,s}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:if(this.cache[this._makeAbs(e)]=!1,this.strict)throw t;this.silent||console.error("glob error",t)}},rr.prototype._processGlobStar=function(e,t,r,s,i,n){var o=this._readdir(r,n);if(o){var a=s.slice(1),c=e?[e]:[],u=c.concat(a);this._process(u,i,!1);var l=o.length;if(!this.symlinks[r]||!n)for(var h=0;h<l;h++){if("."!==o[h].charAt(0)||this.dot){var p=c.concat(o[h],a);this._process(p,i,!0);var f=c.concat(o[h],s);this._process(f,i,!0)}}}},rr.prototype._processSimple=function(e,t){var r=this._stat(e);if(this.matches[t]||(this.matches[t]=Object.create(null)),r){if(e&&xt(e)&&!this.nomount){var s=/[\/\\]$/.test(e);"/"===e.charAt(0)?e=Z.default.join(this.root,e):(e=Z.default.resolve(this.root,e),s&&(e+="/"))}"win32"===process.platform&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e)}},rr.prototype._stat=function(e){var t=this._makeAbs(e),r="/"===e.slice(-1);if(e.length>this.maxLength)return!1;if(!this.stat&&Xt(this.cache,t)){var s=this.cache[t];if(Array.isArray(s)&&(s="DIR"),!r||"DIR"===s)return s;if(r&&"FILE"===s)return!1}var i=this.statCache[t];if(!i){var n;try{n=L.default.lstatSync(t)}catch(e){if(e&&("ENOENT"===e.code||"ENOTDIR"===e.code))return this.statCache[t]=!1,!1}if(n&&n.isSymbolicLink())try{i=L.default.statSync(t)}catch(e){i=n}else i=n}this.statCache[t]=i;s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||s,(!r||"FILE"!==s)&&s},rr.prototype._mark=function(e){return Zt.mark(this,e)},rr.prototype._makeAbs=function(e){return Zt.makeAbs(this,e)};var sr=function e(t,r){if(t&&r)return e(t)(r);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){s[e]=t[e]})),s;function s(){for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var s=t.apply(this,e),i=e[e.length-1];return"function"==typeof s&&s!==i&&Object.keys(i).forEach((function(e){s[e]=i[e]})),s}};var ir=sr(or),nr=sr(ar);function or(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function ar(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}or.proto=or((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return or(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return ar(this)},configurable:!0})})),ir.strict=nr;var cr=Object.create(null),ur=sr((function(e,t){return cr[e]?(cr[e].push(t),null):(cr[e]=[t],function(e){return ir((function t(){var r=cr[e],s=r.length,i=lr(arguments);try{for(var n=0;n<s;n++)r[n].apply(null,i)}finally{r.length>s?(r.splice(0,s),process.nextTick((function(){t.apply(null,i)}))):delete cr[e]}}))}(e))}));function lr(e){for(var t=e.length,r=[],s=0;s<t;s++)r[s]=e[s];return r}var hr=yr,pr=fe.default.EventEmitter,fr=Zt.setopts,dr=Zt.ownProp,mr=Zt.childrenIgnored,gr=Zt.isIgnored;function yr(e,t,r){if("function"==typeof t&&(r=t,t={}),t||(t={}),t.sync){if(r)throw new TypeError("callback provided to sync glob");return Jt(e,t)}return new br(e,t,r)}yr.sync=Jt;var vr=yr.GlobSync=Jt.GlobSync;function br(e,t,r){if("function"==typeof t&&(r=t,t=null),t&&t.sync){if(r)throw new TypeError("callback provided to sync glob");return new vr(e,t)}if(!(this instanceof br))return new br(e,t,r);fr(this,e,t),this._didRealPath=!1;var s=this.minimatch.set.length;this.matches=new Array(s),"function"==typeof r&&(r=ir(r),this.on("error",r),this.on("end",(function(e){r(null,e)})));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(0===s)return o();for(var n=0;n<s;n++)this._process(this.minimatch.set[n],n,!1,o);function o(){--i._processing,i._processing<=0&&i._finish()}}yr.glob=yr,yr.hasMagic=function(e,t){var r=function(e,t){if(null===t||"object"!=typeof t)return e;for(var r=Object.keys(t),s=r.length;s--;)e[r[s]]=t[r[s]];return e}({},t);r.noprocess=!0;var s=new br(e,r).minimatch.set;if(!e)return!1;if(s.length>1)return!0;for(var i=0;i<s[0].length;i++)if("string"!=typeof s[0][i])return!0;return!1},yr.Glob=br,At(br,pr),br.prototype._finish=function(){if(de.default(this instanceof br),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();Zt.finish(this),this.emit("end",this.found)}},br.prototype._realpath=function(){if(!this._didRealpath){this._didRealpath=!0;var e=this.matches.length;if(0===e)return this._finish();for(var t=this,r=0;r<this.matches.length;r++)this._realpathSet(r,s)}function s(){0==--e&&t._finish()}},br.prototype._realpathSet=function(e,t){var r=this.matches[e];if(!r)return t();var s=Object.keys(r),i=this,n=s.length;if(0===n)return t();var o=this.matches[e]=Object.create(null);s.forEach((function(r,s){r=i._makeAbs(r),Me.realpath(r,i.realpathCache,(function(s,a){s?"stat"===s.syscall?o[r]=!0:i.emit("error",s):o[a]=!0,0==--n&&(i.matches[e]=o,t())}))}))},br.prototype._mark=function(e){return Zt.mark(this,e)},br.prototype._makeAbs=function(e){return Zt.makeAbs(this,e)},br.prototype.abort=function(){this.aborted=!0,this.emit("abort")},br.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))},br.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var e=this._emitQueue.slice(0);this._emitQueue.length=0;for(var t=0;t<e.length;t++){var r=e[t];this._emitMatch(r[0],r[1])}}if(this._processQueue.length){var s=this._processQueue.slice(0);this._processQueue.length=0;for(t=0;t<s.length;t++){var i=s[t];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}},br.prototype._process=function(e,t,r,s){if(de.default(this instanceof br),de.default("function"==typeof s),!this.aborted)if(this._processing++,this.paused)this._processQueue.push([e,t,r,s]);else{for(var i,n=0;"string"==typeof e[n];)n++;switch(n){case e.length:return void this._processSimple(e.join("/"),t,s);case 0:i=null;break;default:i=e.slice(0,n).join("/")}var o,a=e.slice(n);null===i?o=".":xt(i)||xt(e.join("/"))?(i&&xt(i)||(i="/"+i),o=i):o=i;var c=this._makeAbs(o);if(mr(this,o))return s();a[0]===dt.GLOBSTAR?this._processGlobStar(i,o,c,a,t,r,s):this._processReaddir(i,o,c,a,t,r,s)}},br.prototype._processReaddir=function(e,t,r,s,i,n,o){var a=this;this._readdir(r,n,(function(c,u){return a._processReaddir2(e,t,r,s,i,n,u,o)}))},br.prototype._processReaddir2=function(e,t,r,s,i,n,o,a){if(!o)return a();for(var c=s[0],u=!!this.minimatch.negate,l=c._glob,h=this.dot||"."===l.charAt(0),p=[],f=0;f<o.length;f++){if("."!==(m=o[f]).charAt(0)||h)(u&&!e?!m.match(c):m.match(c))&&p.push(m)}var d=p.length;if(0===d)return a();if(1===s.length&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(f=0;f<d;f++){var m=p[f];e&&(m="/"!==e?e+"/"+m:e+m),"/"!==m.charAt(0)||this.nomount||(m=Z.default.join(this.root,m)),this._emitMatch(i,m)}return a()}s.shift();for(f=0;f<d;f++){m=p[f];e&&(m="/"!==e?e+"/"+m:e+m),this._process([m].concat(s),i,n,a)}a()},br.prototype._emitMatch=function(e,t){if(!this.aborted&&!gr(this,t))if(this.paused)this._emitQueue.push([e,t]);else{var r=xt(t)?t:this._makeAbs(t);if(this.mark&&(t=this._mark(t)),this.absolute&&(t=r),!this.matches[e][t]){if(this.nodir){var s=this.cache[r];if("DIR"===s||Array.isArray(s))return}this.matches[e][t]=!0;var i=this.statCache[r];i&&this.emit("stat",t,i),this.emit("match",t)}}},br.prototype._readdirInGlobStar=function(e,t){if(!this.aborted){if(this.follow)return this._readdir(e,!1,t);var r=this,s=ur("lstat\0"+e,(function(s,i){if(s&&"ENOENT"===s.code)return t();var n=i&&i.isSymbolicLink();r.symlinks[e]=n,n||!i||i.isDirectory()?r._readdir(e,!1,t):(r.cache[e]="FILE",t())}));s&&L.default.lstat(e,s)}},br.prototype._readdir=function(e,t,r){if(!this.aborted&&(r=ur("readdir\0"+e+"\0"+t,r))){if(t&&!dr(this.symlinks,e))return this._readdirInGlobStar(e,r);if(dr(this.cache,e)){var s=this.cache[e];if(!s||"FILE"===s)return r();if(Array.isArray(s))return r(null,s)}L.default.readdir(e,function(e,t,r){return function(s,i){s?e._readdirError(t,s,r):e._readdirEntries(t,i,r)}}(this,e,r))}},br.prototype._readdirEntries=function(e,t,r){if(!this.aborted){if(!this.mark&&!this.stat)for(var s=0;s<t.length;s++){var i=t[s];i="/"===e?e+i:e+"/"+i,this.cache[i]=!0}return this.cache[e]=t,r(null,t)}},br.prototype._readdirError=function(e,t,r){if(!this.aborted){switch(t.code){case"ENOTSUP":case"ENOTDIR":var s=this._makeAbs(e);if(this.cache[s]="FILE",s===this.cwdAbs){var i=new Error(t.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=t.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=!1;break;default:this.cache[this._makeAbs(e)]=!1,this.strict&&(this.emit("error",t),this.abort()),this.silent||console.error("glob error",t)}return r()}},br.prototype._processGlobStar=function(e,t,r,s,i,n,o){var a=this;this._readdir(r,n,(function(c,u){a._processGlobStar2(e,t,r,s,i,n,u,o)}))},br.prototype._processGlobStar2=function(e,t,r,s,i,n,o,a){if(!o)return a();var c=s.slice(1),u=e?[e]:[],l=u.concat(c);this._process(l,i,!1,a);var h=this.symlinks[r],p=o.length;if(h&&n)return a();for(var f=0;f<p;f++){if("."!==o[f].charAt(0)||this.dot){var d=u.concat(o[f],c);this._process(d,i,!0,a);var m=u.concat(o[f],s);this._process(m,i,!0,a)}}a()},br.prototype._processSimple=function(e,t,r){var s=this;this._stat(e,(function(i,n){s._processSimple2(e,t,i,n,r)}))},br.prototype._processSimple2=function(e,t,r,s,i){if(this.matches[t]||(this.matches[t]=Object.create(null)),!s)return i();if(e&&xt(e)&&!this.nomount){var n=/[\/\\]$/.test(e);"/"===e.charAt(0)?e=Z.default.join(this.root,e):(e=Z.default.resolve(this.root,e),n&&(e+="/"))}"win32"===process.platform&&(e=e.replace(/\\/g,"/")),this._emitMatch(t,e),i()},br.prototype._stat=function(e,t){var r=this._makeAbs(e),s="/"===e.slice(-1);if(e.length>this.maxLength)return t();if(!this.stat&&dr(this.cache,r)){var i=this.cache[r];if(Array.isArray(i)&&(i="DIR"),!s||"DIR"===i)return t(null,i);if(s&&"FILE"===i)return t()}var n=this.statCache[r];if(void 0!==n){if(!1===n)return t(null,n);var o=n.isDirectory()?"DIR":"FILE";return s&&"FILE"===o?t():t(null,o,n)}var a=this,c=ur("stat\0"+r,(function(s,i){if(i&&i.isSymbolicLink())return L.default.stat(r,(function(s,n){s?a._stat2(e,r,null,i,t):a._stat2(e,r,s,n,t)}));a._stat2(e,r,s,i,t)}));c&&L.default.lstat(r,c)},br.prototype._stat2=function(e,t,r,s,i){if(r&&("ENOENT"===r.code||"ENOTDIR"===r.code))return this.statCache[t]=!1,i();var n="/"===e.slice(-1);if(this.statCache[t]=s,"/"===t.slice(-1)&&s&&!s.isDirectory())return i(null,!1,s);var o=!0;return s&&(o=s.isDirectory()?"DIR":"FILE"),this.cache[t]=this.cache[t]||o,n&&"FILE"===o?i():i(null,o,s)};let _r=()=>{const t=ke.watchIgnoreDirectory.sass.slice();t.unshift(ke.watchDirectory.sass);e.watch(t).on("change",(function(e,t){let r=Z.default.basename(e),s=/^_.{5,}/.test(r);Ee(s)}));if(hr.sync(ke.watchDirectory.es).length){console.log("[dev-template] use es files.");const t=ke.watchIgnoreDirectory.es.slice();t.unshift(ke.watchDirectory.es),e.watch(t,De)}else e.watch(ke.watchDirectory.jspre,De);e.watch(ke.watchDirectory.ejs,Se),N.default.notify({title:"Start Gulp",message:new Date,sound:"Glass"})},wr=e=>{let t=ke.cleanDirectory;return me.default(t,e)},$r=e=>{let t={};t={php:!1,bin:"php",host:"127.0.0.1",port:"3333",baseDir:ke.outputDirectory.dev},ke.user.php&&(t.php=ke.user.php),ke.env.php&&(t.php=ke.env.php),t.php?C.exec(`${t.bin} -S ${t.host}:${t.port} -t ${t.baseDir}`,((t,r,s)=>{t&&console.log("[dev-template] "+t),e()})):(console.log("[dev-template] PHP Server. Boot failure."),e())},jr=e=>{let t={};t={twig:!1,bin:"php",host:"127.0.0.1",port:"3333",router:"_twig/router.php"},ke.user.twig&&(t.twig=ke.user.twig),ke.env.twig&&(t.twig=ke.env.twig),t.twig?C.exec(`cd ${ke.outputDirectory.dev} && ${t.bin} -S ${t.host}:${t.port} ${t.router}`,((t,r,s)=>{t&&console.log("[dev-template] "+t),e()})):(console.log("[dev-template] Twig Server. Boot failure."),e())},kr=`${ye.name.toUpperCase()}\n- Version ${ye.version}\n- Copyright ${ye.author}`;console.log("-".repeat(38)+"\n"+kr+"\n"+"-".repeat(38));var Er=e.series(wr,Se,Ee,De,e.parallel($r,jr,qe,_r));const Or=e.series(wr,Se,Ee,De,e.parallel($r,jr,qe,_r)),Ar=e.series(wr,Se,Ee,De,(()=>{let t=ke.deployDirectory.slice();if(ke.user.webpack){let e=ke.user.webpackConfig?`../../${ke.user.webpackConfig}`:"../../webpack.config.js",r=require(e);Object.keys(r.entry).forEach((function(e){t.push(`!${ke.path.source}**/*${Z.default.basename(r.entry[e])}`)}))}let r="";return e.src("./package.json").pipe(ge.default.prompt({type:"input",name:"dir",message:"Please output directory name."},(function(s){return s.dir&&(r=s.dir),!!s.dir&&e.src(t).pipe(ue.default.include({isFile:!0})).pipe(e.dest(r))})))}));exports.default=Er,exports.deploy=Ar,exports.prod=Or;
